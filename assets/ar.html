<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <script src="./aframe-master.min.js"></script>
    <script src="./aframe-ar-nft.js"></script>
    <link rel="stylesheet" type="text/css" href="./ar-style.css" />
  </head>

  <script>
    function triggerOverlay(text) {
      const interactionMessage = document.querySelector('.interaction-message');
      interactionMessage.textContent = text;
      overlay.parent.classList.remove('hidden');
    }

    AFRAME.registerComponent('markerhandler', {
      init: function () {
        const m0 = document.querySelector('.mark0');
        const m1 = document.querySelector('.mark1');
        const m2 = document.querySelector('.mark2');
        const m3 = document.querySelector('.mark3');
        const m4 = document.querySelector('.mark4');
        const m5 = document.querySelector('.mark5');
        const m6 = document.querySelector('.mark6');

        m0.addEventListener('markerFound', () => {
          triggerOverlay('marker 1 was found');
          window.parent.document
            .querySelector('.item1')
            .classList.add('--found');
        });
        m1.addEventListener('markerFound', () => {
          triggerOverlay('marker 1 was found');
          window.parent.document
            .querySelector('.item2')
            .classList.add('--found');
        });
        m2.addEventListener('markerFound', () => {
          triggerOverlay('marker 2 was found');
        });
        m3.addEventListener('markerFound', () => {
          triggerOverlay('marker 3 was found');
          window.parent.document
            .querySelector('.item3')
            .classList.add('--found');
        });
        m4.addEventListener('markerFound', () => {
          triggerOverlay('marker 4 was found');

          window.parent.document
            .querySelector('.item4')
            .classList.add('--found');
        });
        m5.addEventListener('markerFound', () => {
          triggerOverlay('marker 5 was found');
        });
        m6.addEventListener('markerFound', () => {
          triggerOverlay('marker 6 was found');
        });
      },
    });

    // send message to parent window
    const handleMarkerTrigger = (e) => {
      const overlay = document.querySelector('.top-overlay');
      overlay.textContent = `marker ${e}`;
      window.parent.postMessage(e, '*');
    };
  </script>

  <body style="margin: 0px; overflow: hidden">
    <div class="top-overlay">
      <!-- <button onclick="testFn()">YO</button> -->
      <img src="./text-deco.jpg" alt="" />
      <span class="interaction-message">...</span>
      <img class="flipped-corner" src="./text-deco.jpg" alt="" />
    </div>

    <div class="test-buttons">
      <button onclick="handleMarkerTrigger(0)">trigger marker 0</button>
      <button onclick="handleMarkerTrigger(1)">trigger marker 1</button>
      <button onclick="handleMarkerTrigger(2)">trigger marker 2</button>
      <button onclick="handleMarkerTrigger(3)">trigger marker 3</button>
      <button onclick="handleMarkerTrigger(4)">trigger marker 4</button>
      <button onclick="handleMarkerTrigger(5)">trigger marker 5</button>
      <button onclick="handleMarkerTrigger(6)">trigger marker 6</button>
    </div>

    <a-scene
      class="camera-scene"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    >
      <a-assets>
        <a-asset-item id="tree" src="./tree.gltf"></a-asset-item>
        <a-asset-item id="houses" src="./houses.gltf"></a-asset-item>
      </a-assets>
      <!-- Defines the marker that we are going to use. Notice that we are not providing the image file, but the  -->
      <!-- "compiled" .patt file that we got from the online tool. the marker MUST BE ACCESSIBLE VIA HTTPS -->
      <a-marker markerhandler type="barcode" value="0" class="mark1">
        <a-gltf-model src="#tree"></a-gltf-model>
        <a-entity
          text="value: 0; color: #BBB"
          position="5 0.2 0"
          scale="10 10 10"
          rotation="-90 0 0"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="1" class="mark2">
        <a-box color="tomato" depth="2" height="2" width="2"></a-box>
        <a-entity
          text="value: 1; color: #BBB"
          position="5 0.2 0"
          scale="10 10 10"
          rotation="-90 0 0"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="3" class="mark3">
        <a-tetrahedron color="#FF926B" radius="5"></a-tetrahedron>
      </a-marker>

      <a-marker type="barcode" value="4" class="mark4">
        <a-box color="#44444a" depth=".5" height=".5" width=".5"></a-box>
        <a-entity
          text="value: 4; color: #BBB"
          position="5 0.2 0"
          scale="10 10 10"
          rotation="-90 0 0"
        ></a-entity>
      </a-marker>

      <a-marker type="barcode" value="5" class="mark5">
        <a-box color="#44444a" depth=".5" height=".5" width=".5"></a-box>
        <a-entity
          text="value: 5; color: #BBB"
          position="5 0.2 0"
          scale="10 10 10"
          rotation="-90 0 0"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="6" class="mark6">
        <a-entity
          text="value: 6; color: #BBB"
          position="5 0.2 0"
          scale="10 10 10"
          rotation="-90 0 0"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="7" class="mark7">
        <a-box color="tomato" depth="1" height="1" width="1"></a-box>
        <a-entity
          text="value: 7; color: #BBB"
          position="5 0.2 0"
          scale="10 10 10"
          rotation="-90 0 0"
        ></a-entity>
      </a-marker>

      <!-- Define the camera of the scene -->
      <a-camera-static> </a-camera-static>
    </a-scene>
    <script>
      const sceneEl = document.querySelector('.camera-scene');
      sceneEl.addEventListener('render-target-loaded', function () {
        // sceneEl.renderer is now set.
      });
    </script>
  </body>
</html>
<style>
  html {
    width: 100vw;
  }
</style>
